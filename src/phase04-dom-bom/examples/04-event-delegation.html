<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>äº‹ä»¶å§”æ‰˜</title>
    <style>
      body {
        font-family: system-ui, sans-serif;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background: #f5f5f5;
      }
      h1 {
        text-align: center;
        color: #333;
      }
      h2 {
        color: #667eea;
        margin-top: 30px;
        border-bottom: 2px solid #667eea;
        padding-bottom: 8px;
      }
      .demo {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        margin: 15px 0;
      }
      pre {
        background: #2d2d2d;
        color: #f8f8f2;
        padding: 12px;
        border-radius: 6px;
        overflow-x: auto;
        font-size: 13px;
      }
      button {
        padding: 8px 16px;
        background: #667eea;
        color: white;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #5a6fd6;
      }
      .output {
        background: #f0f0f0;
        padding: 15px;
        border-radius: 6px;
        margin-top: 10px;
        font-family: monospace;
      }
      ul {
        list-style: none;
        padding: 0;
      }
      li {
        padding: 12px 15px;
        background: #f8f9fa;
        margin: 8px 0;
        border-radius: 6px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        transition: all 0.3s;
      }
      li:hover {
        background: #e3f2fd;
      }
      .btn-delete {
        background: #dc3545;
        padding: 5px 12px;
        font-size: 14px;
      }
      .btn-edit {
        background: #28a745;
        padding: 5px 12px;
        font-size: 14px;
      }
      input[type="text"] {
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 16px;
        flex: 1;
        margin-right: 10px;
      }
      .add-form {
        display: flex;
        margin-bottom: 15px;
      }
      .note {
        background: #e3f2fd;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        border-left: 4px solid #667eea;
      }
      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
        gap: 10px;
      }
      .grid-item {
        padding: 30px 20px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        text-align: center;
        border-radius: 8px;
        cursor: pointer;
        transition: transform 0.2s;
      }
      .grid-item:hover {
        transform: scale(1.05);
      }
      .tab-container {
        display: flex;
        border-bottom: 2px solid #ddd;
      }
      .tab {
        padding: 12px 24px;
        cursor: pointer;
        border-bottom: 3px solid transparent;
        margin-bottom: -2px;
        transition: all 0.3s;
      }
      .tab:hover {
        background: #f0f0f0;
      }
      .tab.active {
        border-bottom-color: #667eea;
        color: #667eea;
        font-weight: bold;
      }
      .tab-content {
        padding: 20px;
        background: #f8f9fa;
        border-radius: 0 0 8px 8px;
        min-height: 100px;
      }
    </style>
  </head>
  <body>
    <h1>ğŸ¯ äº‹ä»¶å§”æ‰˜ (Event Delegation)</h1>

    <div class="note">
      <strong>ä»€ä¹ˆæ˜¯äº‹ä»¶å§”æ‰˜ï¼Ÿ</strong><br />
      åˆ©ç”¨äº‹ä»¶å†’æ³¡æœºåˆ¶ï¼Œå°†å­å…ƒç´ çš„äº‹ä»¶å¤„ç†ç¨‹åºç»‘å®šåˆ°çˆ¶å…ƒç´ ä¸Šã€‚
      <br /><br />
      <strong>ä¼˜ç‚¹ï¼š</strong>
      <ul>
        <li>âœ… å‡å°‘äº‹ä»¶ç›‘å¬å™¨æ•°é‡ï¼Œæé«˜æ€§èƒ½</li>
        <li>âœ… åŠ¨æ€æ·»åŠ çš„å­å…ƒç´ è‡ªåŠ¨æ‹¥æœ‰äº‹ä»¶å¤„ç†</li>
        <li>âœ… å‡å°‘å†…å­˜å ç”¨</li>
      </ul>
    </div>

    <!-- åŸºç¡€äº‹ä»¶å§”æ‰˜ -->
    <h2>1. åŸºç¡€äº‹ä»¶å§”æ‰˜</h2>
    <div class="demo">
      <pre>
// ä¸ä½¿ç”¨äº‹ä»¶å§”æ‰˜ (âŒ éœ€è¦ä¸ºæ¯ä¸ªæŒ‰é’®ç»‘å®š)
buttons.forEach(btn => btn.addEventListener('click', handler));

// ä½¿ç”¨äº‹ä»¶å§”æ‰˜ (âœ… åªç»‘å®šåˆ°çˆ¶å…ƒç´ )
parent.addEventListener('click', (e) => {
    if (e.target.matches('.btn')) {
        // å¤„ç†ç‚¹å‡»
    }
});</pre
      >
      <div class="grid" id="grid1">
        <div class="grid-item" data-id="1">Item 1</div>
        <div class="grid-item" data-id="2">Item 2</div>
        <div class="grid-item" data-id="3">Item 3</div>
        <div class="grid-item" data-id="4">Item 4</div>
        <div class="grid-item" data-id="5">Item 5</div>
        <div class="grid-item" data-id="6">Item 6</div>
      </div>
      <button onclick="addGridItem()">æ·»åŠ æ–°é¡¹ç›®</button>
      <div class="output" id="output1">ç‚¹å‡»ä¸Šé¢çš„é¡¹ç›®...</div>
    </div>

    <!-- åˆ—è¡¨æ“ä½œ -->
    <h2>2. åˆ—è¡¨å¢åˆ æ”¹æŸ¥ (å®æˆ˜åº”ç”¨)</h2>
    <div class="demo">
      <pre>
list.addEventListener('click', (e) => {
    const item = e.target.closest('li');
    if (!item) return;
    
    if (e.target.matches('.btn-delete')) {
        item.remove();
    } else if (e.target.matches('.btn-edit')) {
        // ç¼–è¾‘é€»è¾‘
    }
});</pre
      >
      <div class="add-form">
        <input type="text" id="newItemInput" placeholder="è¾“å…¥æ–°é¡¹ç›®åç§°..." />
        <button onclick="addListItem()">æ·»åŠ </button>
      </div>
      <ul id="list2">
        <li>
          <span>å­¦ä¹  JavaScript</span>
          <div>
            <button class="btn-edit">ç¼–è¾‘</button>
            <button class="btn-delete">åˆ é™¤</button>
          </div>
        </li>
        <li>
          <span>ç»ƒä¹  DOM æ“ä½œ</span>
          <div>
            <button class="btn-edit">ç¼–è¾‘</button>
            <button class="btn-delete">åˆ é™¤</button>
          </div>
        </li>
        <li>
          <span>æŒæ¡äº‹ä»¶å§”æ‰˜</span>
          <div>
            <button class="btn-edit">ç¼–è¾‘</button>
            <button class="btn-delete">åˆ é™¤</button>
          </div>
        </li>
      </ul>
      <div class="output" id="output2">æ“ä½œæ—¥å¿—...</div>
    </div>

    <!-- Tab åˆ‡æ¢ -->
    <h2>3. Tab åˆ‡æ¢</h2>
    <div class="demo">
      <pre>
tabs.addEventListener('click', (e) => {
    if (!e.target.matches('.tab')) return;
    
    // ç§»é™¤æ‰€æœ‰ active
    tabs.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
    // æ·»åŠ  active
    e.target.classList.add('active');
});</pre
      >
      <div class="tab-container" id="tabs">
        <div class="tab active" data-tab="home">é¦–é¡µ</div>
        <div class="tab" data-tab="products">äº§å“</div>
        <div class="tab" data-tab="about">å…³äº</div>
        <div class="tab" data-tab="contact">è”ç³»</div>
      </div>
      <div class="tab-content" id="tabContent">é¦–é¡µå†…å®¹</div>
    </div>

    <!-- äº‹ä»¶å§”æ‰˜ä¸­çš„ closest -->
    <h2>4. ä½¿ç”¨ closest() å¤„ç†åµŒå¥—ç»“æ„</h2>
    <div class="demo">
      <pre>
// å½“ç‚¹å‡»çš„æ˜¯å­å…ƒç´ æ—¶ï¼Œä½¿ç”¨ closest æ‰¾åˆ°ç›®æ ‡å…ƒç´ 
container.addEventListener('click', (e) => {
    const card = e.target.closest('.card');
    if (!card) return;
    // card å°±æ˜¯æˆ‘ä»¬è¦æ“ä½œçš„å…ƒç´ 
});</pre
      >
      <div id="cardContainer">
        <div class="grid-item" data-card="1">
          <strong>å¡ç‰‡ 1</strong>
          <p style="font-size: 12px; margin-top: 5px">ç‚¹å‡»ä»»æ„ä½ç½®</p>
        </div>
        <div class="grid-item" data-card="2">
          <strong>å¡ç‰‡ 2</strong>
          <p style="font-size: 12px; margin-top: 5px">ç‚¹å‡»ä»»æ„ä½ç½®</p>
        </div>
        <div class="grid-item" data-card="3">
          <strong>å¡ç‰‡ 3</strong>
          <p style="font-size: 12px; margin-top: 5px">ç‚¹å‡»ä»»æ„ä½ç½®</p>
        </div>
      </div>
      <div class="output" id="output4">ç‚¹å‡»å¡ç‰‡...</div>
    </div>

    <!-- é€šç”¨äº‹ä»¶å§”æ‰˜å‡½æ•° -->
    <h2>5. å°è£…é€šç”¨äº‹ä»¶å§”æ‰˜å‡½æ•°</h2>
    <div class="demo">
      <pre>
function delegate(parent, eventType, selector, handler) {
    parent.addEventListener(eventType, function(e) {
        const target = e.target.closest(selector);
        if (target && parent.contains(target)) {
            handler.call(target, e);
        }
    });
}

// ä½¿ç”¨
delegate(document.body, 'click', '.btn', function(e) {
    console.log('è¢«ç‚¹å‡»çš„æŒ‰é’®:', this);
});</pre
      >
      <div id="delegateDemo">
        <button class="demo-btn" data-action="save">ä¿å­˜</button>
        <button class="demo-btn" data-action="cancel">å–æ¶ˆ</button>
        <button class="demo-btn" data-action="submit">æäº¤</button>
      </div>
      <div class="output" id="output5">ç‚¹å‡»æŒ‰é’®...</div>
    </div>

    <script>
      // å·¥å…·å‡½æ•°
      function log(id, msg) {
        document.getElementById(id).textContent = msg;
      }

      // é€šç”¨äº‹ä»¶å§”æ‰˜å‡½æ•°
      function delegate(parent, eventType, selector, handler) {
        parent.addEventListener(eventType, function (e) {
          const target = e.target.closest(selector);
          if (target && parent.contains(target)) {
            handler.call(target, e);
          }
        });
      }

      // 1. åŸºç¡€äº‹ä»¶å§”æ‰˜
      let gridCounter = 6;

      document.getElementById("grid1").addEventListener("click", function (e) {
        const item = e.target.closest(".grid-item");
        if (!item) return;

        const id = item.dataset.id;
        log("output1", `ç‚¹å‡»äº† Item ${id}`);

        // æ·»åŠ åŠ¨ç”»æ•ˆæœ
        item.style.transform = "scale(0.95)";
        setTimeout(() => (item.style.transform = ""), 100);
      });

      function addGridItem() {
        gridCounter++;
        const grid = document.getElementById("grid1");
        const newItem = document.createElement("div");
        newItem.className = "grid-item";
        newItem.dataset.id = gridCounter;
        newItem.textContent = `Item ${gridCounter}`;
        grid.appendChild(newItem);
        log("output1", `æ·»åŠ äº† Item ${gridCounter} (æ–°å…ƒç´ è‡ªåŠ¨æ‹¥æœ‰äº‹ä»¶å¤„ç†!)`);
      }

      // 2. åˆ—è¡¨æ“ä½œ
      document.getElementById("list2").addEventListener("click", function (e) {
        const li = e.target.closest("li");
        if (!li) return;

        if (e.target.matches(".btn-delete")) {
          const text = li.querySelector("span").textContent;
          li.style.animation = "fadeOut 0.3s";
          setTimeout(() => li.remove(), 300);
          log("output2", `åˆ é™¤: ${text}`);
        } else if (e.target.matches(".btn-edit")) {
          const span = li.querySelector("span");
          const newText = prompt("ç¼–è¾‘å†…å®¹:", span.textContent);
          if (newText !== null) {
            span.textContent = newText;
            log("output2", `ç¼–è¾‘ä¸º: ${newText}`);
          }
        }
      });

      function addListItem() {
        const input = document.getElementById("newItemInput");
        const text = input.value.trim();
        if (!text) return;

        const li = document.createElement("li");
        li.innerHTML = `
                <span>${text}</span>
                <div>
                    <button class="btn-edit">ç¼–è¾‘</button>
                    <button class="btn-delete">åˆ é™¤</button>
                </div>
            `;
        document.getElementById("list2").appendChild(li);
        input.value = "";
        log("output2", `æ·»åŠ : ${text}`);
      }

      // Enter é”®æ·»åŠ 
      document
        .getElementById("newItemInput")
        .addEventListener("keydown", function (e) {
          if (e.key === "Enter") addListItem();
        });

      // 3. Tab åˆ‡æ¢
      const tabContents = {
        home: "ğŸ  é¦–é¡µå†…å®¹ - æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„ç½‘ç«™ï¼",
        products: "ğŸ“¦ äº§å“å†…å®¹ - æŸ¥çœ‹æˆ‘ä»¬çš„ç²¾é€‰äº§å“...",
        about: "ğŸ“– å…³äºæˆ‘ä»¬ - æˆ‘ä»¬æ˜¯ä¸€å®¶ä¸“æ³¨äº...",
        contact: "ğŸ“ è”ç³»æˆ‘ä»¬ - é‚®ç®±: example@mail.com",
      };

      document.getElementById("tabs").addEventListener("click", function (e) {
        if (!e.target.matches(".tab")) return;

        // æ›´æ–° active çŠ¶æ€
        this.querySelectorAll(".tab").forEach((t) =>
          t.classList.remove("active"),
        );
        e.target.classList.add("active");

        // æ›´æ–°å†…å®¹
        const tabId = e.target.dataset.tab;
        document.getElementById("tabContent").textContent = tabContents[tabId];
      });

      // 4. closest ç¤ºä¾‹
      document
        .getElementById("cardContainer")
        .addEventListener("click", function (e) {
          const card = e.target.closest("[data-card]");
          if (!card) return;

          const cardId = card.dataset.card;
          log(
            "output4",
            `ç‚¹å‡»äº†å¡ç‰‡ ${cardId}ï¼Œå³ä½¿ç‚¹å‡»çš„æ˜¯å†…éƒ¨çš„ <strong> æˆ– <p> å…ƒç´ `,
          );
        });

      // 5. é€šç”¨å§”æ‰˜å‡½æ•°ç¤ºä¾‹
      delegate(
        document.getElementById("delegateDemo"),
        "click",
        ".demo-btn",
        function (e) {
          const action = this.dataset.action;
          log("output5", `æ‰§è¡Œæ“ä½œ: ${action}`);
        },
      );

      // æ·»åŠ æ·¡å‡ºåŠ¨ç”»
      const style = document.createElement("style");
      style.textContent = `
            @keyframes fadeOut {
                from { opacity: 1; transform: translateX(0); }
                to { opacity: 0; transform: translateX(-20px); }
            }
        `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
